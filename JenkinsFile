pipeline { 
    agent { label 'master' }
    environment {
        KUBECONFIG = credentials('a700aafc-b29c-4052-a8f8-c93863709f25')
    }    
    stages {
        stage('Setup') { 
            steps { 
                sh '''#!/bin/bash
                    python3 -m venv scenario
                    source scenario/bin/activate
                    echo "=== current dir ==="
                    pwd
                    echo "=== content ==="
                    ls -l
                    echo "==============="
                    pip install --exists-action i yamllint
                    pip install --exists-action i flake8
                    pip install --exists-action i pytest
                    pip install .
                    oc version
                    which yamllint
                    which flake8
                    which pytest
                    oc projects
                '''
            }
        }
        stage('Execute') { 
            steps { 
                sh '''#!/bin/bash
                    ls -lia
                    # pushd poc_repo
                    # pytest -sv poc_repo/tests/services/test_ocp_projects.py
                '''
            }
        }        
    }
}
