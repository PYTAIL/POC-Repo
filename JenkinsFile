pipeline { 
    agent { label 'master' }
    stages {
        stage('Setup') {
            steps {
                sh '''#!/bin/bash
                    pip install yamllint
                    pip install flake8
                    pip install ansible-lint
                    pip install ansible

                    if [[ -f output/poc_repo.tar ]]; then
                        rm output/poc_repo.tar
                    fi

                    mkdir -p output
                    tar -cvf output/poc_repo.tar *
                    ls -lia
                '''
            }
        }
        stage('ExecuteGateJob') {
            steps {
                script {
                    build(job: "GateJob",
                        parameters:
                        [string(name: 'ARCHIVEPATH', value: "$WORKSPACE/output/poc_repo.tar")])
                }            
            
                // build 'GateJob'	//this is where we specify which job to invoke.
                // parameters: string(name: 'Path', value: "$WORKSPACE/output/poc_repo.tar")
                // [string(name: 'Path', value: "$WORKSPACE/output/poc_repo.tar")]
            }            
        }        
    }
    
    // post {
    //     always {
    //         archiveArtifacts artifacts: 'output/poc_repo.tar', fingerprint: true
    //     }
    // }
}
